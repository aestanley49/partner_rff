---
title: "Partnerships_draft_code"
author: "Annabelle"
date: "July 14, 2020"
output:
  html_document: default
  word_document: default
---

Note: network stats are a bit scattered because doc was put together for figure creation (most should be at the bottom..)
Up next - try and see why there arn't many edges in big networks.. plus do stats


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Set up file structure 
```{r, include = FALSE}
## setup the file structure so that this markdown document is in the main project folder along with the other folders noted below

DataSource <- "./data" # input raw dataset goes here
output.dir <-"./output" # output dataset writes to here
functions.dir <- "./functions" # directory for functions 

source(file.path(functions.dir,'FormatData.R')) # any functions that are called up by this markdown document need to be sourced here
source(file.path(functions.dir,'cleaning_salafsky.R')) # any functions that are called up by this markdown document need to be sourced here
source(file.path(functions.dir,'FormatwCollabs.R')) # any functions that are called up by this markdown document need to be sourced here
source(file.path(functions.dir,'salafsky_final_edits.R')) # any functions that are called up by this markdown document need to be sourced here
source(file.path(functions.dir,'multipartnerstrings.R')) # any functions that are called up by this markdown document need to be sourced here

## general functions that need to be read in. I like to put them at the top so they are easier to deal with when they change version (inevitable)
library(plyr) #for function "join_all" also note, there can be issue loading this after dplyr (which is why it's at the top)
library(readr)
library(readxl)
library(tidyverse)
library(dplyr)
library(janitor) #used in cleaning 
library(stringr)
library(car) #for function qqplot 
library(knitr) #for making tables form kable 
library(data.table) #function setnames() allows to set multiple column names in one line of code 
library(igraph)
```

##load in different datasets
```{r, echo = FALSE, include = FALSE}
CleanData <- read.csv(paste0(DataSource,"/codesalafsky.csv"), stringsAsFactors = FALSE) #removing end piece  ## codesalafsky.csv is the rawest data that function runs on
code <- cleaning_salafsky(CleanData)
sdata <- read_csv(paste(DataSource,"/tableofpartnersandactions.csv", sep = "")) #this csv is produced at end of cleaning_salafsky.R function 
#sdata <- sdata %>% select(-X1) #remove X1 column that is getting produced 

tdata <- read.csv(paste0(DataSource,"/Updated_variables.csv"), stringsAsFactors = FALSE) #data provided by tyler 
tdata <- tdata %>%  as_tibble() #now can use stringr packages 
tdata <- tdata %>%  ##cleaning/reformating colunm names --> default is lower_case_snake
                  clean_names()
##

tableofPandA <- read.csv(paste0("/usr/local/bin/store/partner_rff/data/tableofPandAmodified.csv"), stringsAsFactors = FALSE, na = "", #issue was that "" is coming up instead of NA
               strip.white=TRUE)
## New csv made for changes made as final cleaning steps (replacing partner strings that were "all" with relevant partner names)
modPA <- salafsky_final_edits(tableofPandA)
docspef <- multipartnerstrings(modPA)

PartnersDataModified <- read.csv(paste0("/usr/local/bin/store/partner_rff/data/PartnersDataModified.csv"), 
                                stringsAsFactors = FALSE, na = c("", " ", "NA"))
newpdata <- FormatwCollabs(PartnersDataModified)



# ----> including prep in script.. 

orgtyp_base <- read.csv(paste0("/usr/local/bin/store/partner_rff/data/tableofPandAmodified.csv"), stringsAsFactors = FALSE, na = "") #issue was that "" is coming up instead of NA
## file name got changed

#orgtype <- orgtyp_base ## taken from Data_exploration script 

#average center point 
center <- read_excel(paste0(DataSource, "/mean_center_range_subsetofprecluded_with_partnerdata.xlsx"))
```



#### Number of species 
```{r}
# number count 
pcount <- newpdata[-c(91,92),]
pcount <- pcount[-which(is.na(pcount$partner_names)),]
dim(pcount) ##52 

# salafsky counts 
docspef <- as.data.frame(docspef)
#count(unique(docspef$Scientific.name)) ##37
```


#### Number of partners
##### Larger df 
```{r}
FedAg_w_collab <- pcount[,c(1,2,5)]

EditedData <- FedAg_w_collab

for (i in 1:nrow(EditedData)) {
  dvec <- trimws(strsplit(EditedData$FedAg_w_collab[i],split=",")[[1]])
  for (dname in dvec) {
    if (dname%in%colnames(EditedData)) {
      EditedData[i, dname] <- 1              
    } else {
      EditedData[dname] <- 0
      EditedData[i, dname] <- 1                                    
    }
  }
}

dim(EditedData) #295 - 3(first three columns in df) = 292 - this is different because now includes Fed Agency offices and what were previously collaborators
```


##### Larger df 
```{r}

#count(unique(docspef$partner.in.agreement)) #140 
## still have 3 groups issues to take care of 

```



## Figures for doc


##### 1. # of partners per species 
```{r}
alldf <- docspef
nopartners <- (alldf %>% group_by(Scientific.name)   #selecting  each species
%>% distinct(partner.in.agreement)    #count how many partners are distinct 
%>% summarise(n()))                   # Count the number of distinct 

#kable(nopartners)

nopartners <- rename(nopartners, tally = 'n()')

#reset as bar plot with each species name as value on x-axis 

ordered <- nopartners %>% arrange(-tally)


#ordered$Scientific.name

ggplot(ordered) + geom_bar(mapping = aes(x = reorder(Scientific.name, -tally), y = tally), stat = "identity") + theme(axis.text.x = element_text(angle = 90)) + scale_x_discrete(name ="Common Name") + scale_y_continuous(name ="# of partners working on species") 


#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/#ofPartnersPerSpecies.jpg")
ggplot(ordered) + geom_bar(mapping = aes(x = reorder(Scientific.name, -tally), y = tally), stat = "identity") + theme(axis.text.x = element_text(angle = 90)) + scale_x_discrete(name ="Common Name") + scale_y_continuous(name ="# of partners working on species") 
#Save the file 
dev.off()

```


##### 2. Spatial distribution of species 
```{r}
plot(center$YCoord ~ center$XCoord)
```
I made this plot in arcgis online with a super limited platform and there wasn't anyway I could see to make the modifications :/ worth switching to use qgis?? 


##### 3. Species per Partner 

Count of the number of speies partner work on

```{r, echo = FALSE}
# the number of species that each partner works on:
#PartnerData <- FormatData(RawData) #reload data to avoid sum(colsums) glitch

#	Histogram of species/partner 

count <- colSums(EditedData[,-c(1:3)])

#hist(colSums(EditedData[,-c(1:3)]),
 #    xlab ="number of species that a partner works on",
  #   breaks = 50, 
   #  main = "Count of the number of speies partners work on")


count <- as.data.frame(count)

count <- count %>% rownames_to_column() 

ggplot(count) + geom_histogram(mapping = aes(x = count), stat = "count") + scale_y_continuous(name ="Count") + scale_x_continuous(name ="The Number of Species that a Partner works on")

#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/SpeciesPerPartner.jpg")
ggplot(count) + geom_histogram(mapping = aes(x = count), stat = "count") + scale_y_continuous(name ="Count") + scale_x_continuous(name ="The Number of Species That a Partner Works on")
#Save the file 
dev.off()
```
This is including agency offices which is why fed agency numbers are lower 
Also break in y axis has something to do with scale_y_discrete but I can't figure out what yet.. 



##### 4. Partner types that work together


a include multispecies string information 
- have to join docspef with orgtype_base

```{r echo=FALSE, include=FALSE}
#filter out all rows that don't have values 
orgtyp <- orgtyp_base[-which(is.na(orgtyp_base$type_of_org)),] #this isn't doing anything, lets try again

orgtyp <- orgtyp[,c(1:2,4,8)]
#orgtyp <- orgtyp[,c(1,5)]
#orgtyp <- orgtyp %>% group_by(partner.in.agreement, Scientific.name, agreement.number)

### add common names to scientfic names in docspef
common_names <- orgtyp_base[,c(2,3)]
common_names <- unique( common_names[ , 1:2 ] )

docspef <- docspef %>% left_join(common_names)


orgtyp_start <- docspef %>% left_join(orgtyp) ##not sure how getting 197 rows (seems to add 2 to docspef)
## now getting 202... I think this is due to changes done above w/r/t SB changing to SW & SL

count(unique(orgtyp_start[which(is.na(orgtyp_start$type_of_org)),])) #now there is 67?..should only be 45 NAs
```
***** The join here is what is generating the NAs
Have removed common name so now won't have the same error? Will have to write in org types that were missing for salafsky

but why is a species like flat tailed horn lizard all NULL when half of those partners had info in orgtyp_base?? 
I think when string splits happen, null is override?? 


b
- fix names of partners
- assign to org type 
```{r include= FALSE echo = FALSE}

#bug in the code but can't find where so taking this out/fixing it now
orgtyp_start[which(orgtyp_start$partner.in.agreement == "USFWS Southwest Region	Sceloporus arenicolus	DUNES SAGEBRUSH LIZARD"),3] <- "USFWS Southwest Region"



fixme <- orgtyp_start[which(is.na(orgtyp_start$type_of_org)),]

orgtyp_start[which(orgtyp_start$partner.in.agreement == "BLM"),16] <- "BLM"
orgtyp_start[which(orgtyp_start$partner.in.agreement == "BLM Palm Springs" | orgtyp_start$partner.in.agreement == "BLM Utah State office" | orgtyp_start$partner.in.agreement == "BLM Vernal Field Office" | orgtyp_start$partner.in.agreement == "BLM White River Field Office" | orgtyp_start$partner.in.agreement == "BLM Yuma" |orgtyp_start$partner.in.agreement == "BLM El Centro" ),16] <- "BLM"

orgtyp_start[which(orgtyp_start$partner.in.agreement == "US Bureau of Reclamation Yuma" | orgtyp_start$partner.in.agreement == "US Customs and Border Protection" | orgtyp_start$partner.in.agreement == "EPA" | orgtyp_start$partner.in.agreement == "DOI Office of Surface MIning reclamation and Enforcement" | orgtyp_start$partner.in.agreement == "NPS" | orgtyp_start$partner.in.agreement == "NRCS" | orgtyp_start$partner.in.agreement == "Farm Service Agency" | orgtyp_start$partner.in.agreement == "Bureau of Reclamation"),16] <- "FO"


orgtyp_start[which(orgtyp_start$partner.in.agreement == "USFS Lincoln National Forest" | orgtyp_start$partner.in.agreement == "USFS Pacific Southwest Region Eagle Lake Ranger District Lassen national Forest"),16] <- "USFS"

orgtyp_start[which(orgtyp_start$partner.in.agreement == "USFWS"),16] <- "USFWS"

orgtyp_start[which(orgtyp_start$partner.in.agreement == "USFWS Carlsbad" | orgtyp_start$partner.in.agreement == "USFWS Carlsbad Fish and Wildlife Office " | orgtyp_start$partner.in.agreement == "USFWS Ecological Services New Mexico Field Office" | orgtyp_start$partner.in.agreement == "USFWS Pacific Southwest Region Sacramento Office " | orgtyp_start$partner.in.agreement == "USFWS Phoenix" |orgtyp_start$partner.in.agreement == "USFWS Southwest Region" |orgtyp_start$partner.in.agreement == "USFWS Utah Ecological Services Field Office" |orgtyp_start$partner.in.agreement == "USFWS Utah Field Office"|orgtyp_start$partner.in.agreement == "USFWS Western Colorado Field Office" |orgtyp_start$partner.in.agreement == "Bozeman Fish Technology center (USFWS)" |orgtyp_start$partner.in.agreement == "USFWS Pacific Southwest Region Sacramento Office" |orgtyp_start$partner.in.agreement == "USFWS Carlsbad Fish and Wildlife Office"),16] <- "USFWS"



orgtyp_start[which(orgtyp_start$partner.in.agreement == "Anza-Borrego Desert State Park" | orgtyp_start$partner.in.agreement == "Anza-Borrego Desert State Park (ABDSP)" | orgtyp_start$partner.in.agreement == "Anza-Borrego State Park" |orgtyp_start$partner.in.agreement == "California State Parks" |orgtyp_start$partner.in.agreement == "CPSD State Park"),16] <- "SL" 

orgtyp_start[which(orgtyp_start$partner.in.agreement == "Coral Pink Sand Dunes State Park"),16] <- "SL"

orgtyp_start[which(orgtyp_start$partner.in.agreement == "Utah Department of Parks and Recreation" | orgtyp_start$partner.in.agreement == "Ocotillo Wells State Vehicular Recreation Area" | orgtyp_start$partner.in.agreement == "North Carolina Department of Agriculture & Consumer Services Plant Conservation Program" | orgtyp_start$partner.in.agreement == "Utah School and Institutional Trust Lands Administration"),16] <- "SL"


orgtyp_start[which(orgtyp_start$partner.in.agreement == "Private landowners" | orgtyp_start$partner.in.agreement == "Private Landowners" | orgtyp_start$partner.in.agreement == "B. Kinsely"),16] <- "P"



orgtyp_start[which(orgtyp_start$partner.in.agreement == "366th wing" | orgtyp_start$partner.in.agreement == "The Air force" | orgtyp_start$partner.in.agreement == "U.S. Marine Corps" |orgtyp_start$partner.in.agreement == "U.S. Navy" |orgtyp_start$partner.in.agreement == "Mississippi National Guard"),16] <- "M"

orgtyp_start[which(orgtyp_start$partner.in.agreement == "US Marine Corps" | orgtyp_start$partner.in.agreement == "US Marine Corps Air Station Yuma" | orgtyp_start$partner.in.agreement == "US Naval Air Facility El Centro" |orgtyp_start$partner.in.agreement == "US Navy" |orgtyp_start$partner.in.agreement == "US Navy SW Division"),16] <- "M"


orgtyp_start[which(orgtyp_start$partner.in.agreement == "Kane County" | orgtyp_start$partner.in.agreement == "Otero County" | orgtyp_start$partner.in.agreement == "Village of Cloudcroft" | orgtyp_start$partner.in.agreement == "Uintah County"),16] <- "SG"


orgtyp_start[which(orgtyp_start$partner.in.agreement == "Duke Energy Carolinas" | orgtyp_start$partner.in.agreement == "Portland General Electric"),16] <- "C"

orgtyp_start[which(orgtyp_start$partner.in.agreement == "The Nature Conservancy"| orgtyp_start$partner.in.agreement == "Southern Conservation Corporation"),16] <- "N"

orgtyp_start[which(orgtyp_start$partner.in.agreement == "Montana State University"| orgtyp_start$partner.in.agreement == "Oregon Natural Heritage Program"),16] <- "R"


orgtyp_start[which(orgtyp_start$partner.in.agreement == "Arizona Game and Fish Department" | orgtyp_start$partner.in.agreement == "Utah Division of Wildlife Resources" | orgtyp_start$partner.in.agreement == "Kentucky Department of Fish and Wildlife Resources" | orgtyp_start$partner.in.agreement == "New Mexico Department of Game and Fish"),16] <- "SW"

orgtyp_start[which(orgtyp_start$partner.in.agreement == "Califonia Department of Fish and Game" | orgtyp_start$partner.in.agreement == "California Department of Fish and Game" | orgtyp_start$partner.in.agreement == "California Department of Fish and Wildlife" |orgtyp_start$partner.in.agreement == "California Department of Parks and Recreation"),16] <- "SW"  #*#*### Check categorization



orgtyp_start[which(orgtyp_start$partner.in.agreement == "Illinois Department of Natural Resources" | orgtyp_start$partner.in.agreement == "Indiana Department of Natural Resources" | orgtyp_start$partner.in.agreement == "Montana Fish Wildlife and Parks" | orgtyp_start$partner.in.agreement == "Kentucky Natural Resources and Environmental Cabinet"),16] <- "SB"



### The original ? (now fixed)

orgtyp_start[which(orgtyp_start$partner.in.agreement == "U.S. Army Corps of Engineers"),16] <- "M"
# U.S. Army Corps of Engineers --> based on USA jobs this is actually Military 

# Kentucky Coal Association -- registered as 501(c)6 non-profit organization
orgtyp_start[which(orgtyp_start$partner.in.agreement == "Kentucky Coal Association"),16] <- "N"

# West Kentucky Coal Association (also listed as NGO)
orgtyp_start[which(orgtyp_start$partner.in.agreement == "Western Kentucky Coal Association"),16] <- "N"

# Kentucky Farm Bureau
orgtyp_start[which(orgtyp_start$partner.in.agreement == "Kentucky Farm Bureau"),16] <- "N"

# Oregon Plant Conservation Program - part of state gov that does plant management and R --> double list?
orgtyp_start[which(orgtyp_start$partner.in.agreement == "Oregon Plant Conservation Program"),16] <- "DL"

# Doesn't seem to fit - Utah Governor Public Lands Policy Coordination Office --> SG???
orgtyp_start[which(orgtyp_start$partner.in.agreement == "Utah Governor Public Lands Policy Coordination Office"),16] <- "SG"


orgtyp_start[which(orgtyp_start$partner.in.agreement == "unspecified landowner"),16] <- "P"

orgtyp_start[which(orgtyp_start$partner.in.agreement == "neighboring land owners"),16] <- "P"


# having issues getting edits to stick for Mississippi Department of Wildlife & Mississippi Museum of Natural Sciences ((should just be one partner unit))
    ## So can actually delete duplicated rows because they don't have any vales in action columns (only 1 of the 3 does...) then will rename 

orgtyp_start[which(orgtyp_start$partner.in.agreement == "Mississippi Museum of Natural Sciences"),3] <- "Mississippi Department of Wildlife & Mississippi Museum of Natural Sciences"

## assigning as both Reserach and SW
orgtyp_start[which(orgtyp_start$partner.in.agreement == "Mississippi Department of Wildlife & Mississippi Museum of Natural Sciences"),16] <- "RSW"

orgtyp_start <- orgtyp_start[-which(orgtyp_start$partner.in.agreement == "Mississippi Department of Wildlife"),] 

orgtyp_start <- orgtyp_start[-which(orgtyp_start$partner.in.agreement == "Fisheries and Parks - Mississippi Museum of Natural Sciences (MMNS)"),] 


# can't find Kentucky Coal Country Association on web (even though listed as seperate partner in agreement)
orgtyp_start <- orgtyp_start[-which(orgtyp_start$partner.in.agreement == "Kentucky Coal Country Association"),] 


###### The remaining ?????? 
###########################    Redband Core Group
###########################    ALL (all parties)



orgtyp_start <- orgtyp_start[-which(is.na(orgtyp_start$type_of_org)),]


## remove NAs so don't effect network later
## note - this isn't a long term solution and should be able to comment/delete this later once all partners are assigned groups

```


c

  want to duplicate rows that are have cells labeled SB
```{r}

orgtyp_base2 <- orgtyp_start

dummy <- 2

#subset and duplicate rows with SB as orgtype       
 orgtyp_base3 <-     orgtyp_base2 %>%  
        filter(type_of_org=="SB") %>% 
        uncount(dummy) %>% 
   rownames_to_column() #this is the variable can index on because the rest are the same 
#change one of each rows to SL and the other to SW  
 
orgtyp_base3[which(orgtyp_base3$rowname == 1),17] <- "SW"
orgtyp_base3[which(orgtyp_base3$rowname == 2),17] <- "SL"
orgtyp_base3[which(orgtyp_base3$rowname == 3),17] <- "SW"        
orgtyp_base3[which(orgtyp_base3$rowname == 4),17] <- "SL"   
orgtyp_base3[which(orgtyp_base3$rowname == 5),17] <- "SW"  
orgtyp_base3[which(orgtyp_base3$rowname == 6),17] <- "SL"  
orgtyp_base3[which(orgtyp_base3$rowname == 7),17] <- "SW"  
orgtyp_base3[which(orgtyp_base3$rowname == 8),17] <- "SL"  
orgtyp_base3[which(orgtyp_base3$rowname == 9),17] <- "SW"  
orgtyp_base3[which(orgtyp_base3$rowname == 10),17] <- "SL" 
orgtyp_base3[which(orgtyp_base3$rowname == 11),17] <- "SW"  
orgtyp_base3[which(orgtyp_base3$rowname == 12),17] <- "SL"  
#then need to remove first column so has same dimensions as original df 
orgtyp_base3 <- orgtyp_base3[,-c(1)]

## repeat for Oregon Plant Conservation Program - part of state gov that does plant management and R --> double list?


orgtyp_base4 <-     orgtyp_base2 %>%  
        filter(type_of_org=="DL") %>% 
        uncount(dummy) %>% 
   rownames_to_column()

orgtyp_base4[which(orgtyp_base4$rowname == 1),17] <- "SG"
orgtyp_base4[which(orgtyp_base4$rowname == 2),17] <- "R"

orgtyp_base4 <- orgtyp_base4[,-c(1)]

## And again for.. 
##orgtyp_start[which(orgtyp_start$partner.in.agreement == "Mississippi Department of Wildlife & Mississippi Museum of Natural Sciences"),16] <- "RSW"

orgtyp_base5 <-     orgtyp_base2 %>%  
        filter(type_of_org=="RSW") %>% 
        uncount(dummy) %>% 
   rownames_to_column()

orgtyp_base5[which(orgtyp_base5$rowname == 1),17] <- "SW"
orgtyp_base5[which(orgtyp_base5$rowname == 2),17] <- "R"

orgtyp_base5 <- orgtyp_base5[,-c(1)]

        
#now remove old dataset with SB and join with this new one (rbind should work bc order doesn't matter)

orgtyp_base2 <- orgtyp_base2[-which(orgtyp_base2$type_of_org == "SB"),]
orgtyp_base2 <- orgtyp_base2[-which(orgtyp_base2$type_of_org == "DL"),]
orgtyp_base2 <- orgtyp_base2[-which(orgtyp_base2$type_of_org == "RSW"),]

#orgtyp_base2 <- orgtyp_base2 %>%  
  #      filter(type_of_org !="SB") #removes all rows that have SB 
# so this doesn't actually work because need NAs for other parts of code to work 

#then join 
orgtyp_done <- rbind(orgtyp_base2, orgtyp_base3,orgtyp_base4, orgtyp_base5)
#orgtyp_done <- rbind.fill(orgtyp_base2, orgtyp_base3)

```


Final dataset with action counts, partners, both sci and common names and assigned org types
Write to csv and put in data folder
```{r}
write.csv(orgtyp_done, paste(DataSource,"/finalSdataset_8_29.csv", sep = "")) 
```



d


```{r echo=FALSE, include=FALSE}

orgtyp2 <- orgtyp_done[,c(1,15,16)] 

tidy_orgtyp <- orgtyp2 %>% group_by(Scientific.name) %>% pivot_wider(names_from = type_of_org, values_from = Scientific.name)
#now have dataframe with org types as columns and cell values of species names so can go through species by species and see when two org columns have same value (species)


#to count the number of times partners in an org type work on species, would have to either use this vector: 
##getscinamesback <- orgtyp %>%  left_join(tidy_orgtyp, by = 'Common.name')
#or count number of strings in cell 
#### Count the number of 'a's in each element of string
#####q.data$number.of.a <- str_count(q.data$string, "a")

#convert to df 
orgtyp <- as.data.frame(tidy_orgtyp)

e <- tidy_orgtyp %>% mutate_all(na_if, "NULL")

#setting column names so that they stop moving everytime 
e <- e[,c("Common.name","BLM","FO","USFS","USFWS","P","SL","SG","R","M","C","SW","N")]

f <- as.data.frame(e)

f[!is.na(f)] <- 1
f[is.na(f)] <- 0

#remove first column 
f <- f[,-c(1)]

dim(f)

### make adjacency matrix 
f <- as.matrix(f) 
#indexing is werid and matrix mult won't work so will try and write to csv 

write.csv(f, "/usr/local/bin/store/partner_rff/output/orgtype_adjmat.csv")

g <- read.csv(paste0("/usr/local/bin/store/partner_rff/output/orgtype_adjmat.csv"), stringsAsFactors = FALSE)
#remove first column 
g <- g[,-c(1)]

tg <- (t(g))

write.csv(tg, "/usr/local/bin/store/partner_rff/output/orgtype_adjmat_part2.csv")

h <- read.csv(paste0("/usr/local/bin/store/partner_rff/output/orgtype_adjmat_part2.csv"), stringsAsFactors = FALSE)
#remove first column 

rownames(h) <- h$X #set partnernames as rownames
h[,1] <- NULL #then remove column 

orgtype_adjmat <- as.matrix(h) %*% as.matrix(g)


####### Remove NA column and row (just being generated for the rows in the orgtyp2 dataframe which are blanks for both common name and org type so by removing this bug, not loosing any information)


##orgtype_adjmat <- orgtype_adjmat[-c(8),-c(8)] ## if have issue later on, double check this to make sure it hasn't moved

################### set up network 
```
**** NAs are getting introduced. I think issue starts with blanks in common names but unsure. Join process seems to be introducing a lot of missing information 
Nope so the NAs are rows that haven't been assigned an Org type. Will add section above to manually add. 


-- okay so now that NA issue has been pretty much addressed, can proceed as ususal... 



Note - node labels seem to move every time for this one so need to check 
might actually be shifting as edit csv and sort various columns in that process 
```{r echo=FALSE, include=FALSE}
tadjmat <- orgtype_adjmat


#set row and column names 
rownames(tadjmat) <- c("BLM", "Federal Other", "USFS", "USFWS", "Private Landowner", "State Land", "State Government", "Reserach","Military","Corporation", "State Wildlife", "NGO")

colnames(tadjmat)<- c("BLM", "Federal Other", "USFS", "USFWS", "Private Landowner", "State Land", "State Government", "Reserach","Military","Corporation", "State Wildlife", "NGO")

tadjmat[lower.tri(tadjmat)] <- NA
diag(tadjmat) <- NA

tolist <- tadjmat %>% melt() 
tolist <- tolist[-which(is.na(tolist$value)),]


#library(igraph)

net <- graph_from_data_frame(d=tolist, directed=T) 


E(net)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")



node.size<-setNames(c(14,11,12,34,11,10,6,5,5,5,19,6), c("BLM","FO","USFS","USFWS","P","SL","SG","R","M","C","SW","N"))
  #so not setting in the same order 
#V(net)$label <- NA
E(net)$width <- E(net)$value

plot(net, vertex.size=node.size)

l <- layout_in_circle(net)

plot(net, rescale=F, vertex.color="white", edge.color= "black", vertex.label.color="black", vertex.size=node.size, layout = l)


## source of code - https://stackoverflow.com/questions/23209802/placing-vertex-label-outside-a-circular-layout-in-igraph
radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}


n <- 12
#g <- erdos.renyi.game(n, 0.5)
## Obviously labeling in this way this only makes sense for graphs
## laid out as a circle to begin with

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(net, rescale=F, vertex.color="white", edge.color= "black", vertex.label.color="black", vertex.size=node.size, layout = l, vertex.label.dist=4,
     vertex.label.degree=lab.locs, vertex.label.cex	= .5)


## will rescale node size so doesn't cut off
plot(net, rescale=F, vertex.color="white", edge.color= "black", vertex.label.color="black", vertex.size=node.size*.5, layout = l, vertex.label.dist=4,
     vertex.label.degree=lab.locs, vertex.label.cex	= .5)
## Even now still is a bit cut off and can't see size differences :/ 



jpeg(file = "output/FiguresForPaper_8_31/PartnerTypesThatWorkTogether.jpg")
plot(net, rescale=F, vertex.color="white", edge.color= "black", vertex.label.color="black", vertex.size=node.size*.5, layout = l, vertex.label.dist=4,
     vertex.label.degree=lab.locs, vertex.label.cex	= .5)
#Save the file 
dev.off()

```




Try looking at again? Not sure if there is a way to offset in proportion to the number of characters in label?

Caption: 
node = org type
node size = # of species that all parnters categorized as that org works on
edge width = # of species two orgs work on together 
Note: now where there use to be a SB (state both), this category has been duplicated into both SL and SW

<br>

<br>

<br>

##### 5. Distribution of Actions 
```{r}
df <- docspef
df[,c(4:14)] <- sapply(df[ ,c(4:14)], as.numeric)

names(df) <- c("Scientific.name", "agreement.number", "partner.in.agreement", "Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy",               
                            "Research", "Education","Instiutional Development", "Funding")

colsum <- (as.data.frame(colSums(df[,c(4:14)])) #creating dataframe so can plot
  %>% rownames_to_column()) #making sure that dataframe has rownames to set as x and y 

colsum <- colsum  %>% rename(count = `colSums(df[, c(4:14)])`) #renaming column produced by colsums

colsum <- colsum %>% arrange(count)
  
ggplot(colsum) + geom_bar(mapping = aes(x = reorder(rowname, -count), y = count), stat = "identity")+ theme(axis.text.x = element_text(angle = 90)) + scale_x_discrete(name ="Action Category")



jpeg(file = "output/FiguresForPaper_8_31/DistributionOfActions.jpg")
ggplot(colsum) + geom_bar(mapping = aes(x = reorder(rowname, -count), y = count), stat = "identity")+ theme(axis.text.x = element_text(angle = 90)) + scale_x_discrete(name ="Action Category") + scale_y_continuous(name ="Count")
#Save the file 
dev.off()
```



##### 6. Actions done by player type [for all players]



```{r}

orgtyp_done
```




C = Corporation
no. species = 6
no. partners = 11
```{r echo=FALSE, include=FALSE}


C <- orgtyp_done[which(orgtyp_done$type_of_org == "C"),]



C <- C[,-c(1:3,15:16)] #remove non numeric columns
tC <- t(C)   #transform
C <- t(tC)   #was coming up as non numeric so tranformed again to overwrite

matC <- tC %*%  C



#set row and column names 
rownames(matC) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matC)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")


########### put into network analysis code 


matC[lower.tri(matC)] <- NA
diag(matC) <- NA

Clist <- matC %>% melt() 
Clist <- Clist[-which(is.na(Clist$value)),]

Cnet <- graph_from_data_frame(d=Clist, directed=T) 

E(Cnet)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")
node.size<-setNames(c(8,3,1,0,0,6,1,5,0,8,3), c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding"))
 



E(Cnet)$width <- E(Cnet)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(Cnet, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 


```

one solution to cut off where Land Water Management and Conservation Planning are currently getting cut off might be to switch them with one of the one letter labels?
try here...

switch w law and edu
Didn't work :/ managed to switch labels but values didn't move

*** New place to start problem solving right here... 


C = Corporation
no. species = 5
no. partners = 11
```{r include=FALSE}

C <- orgtyp_done[which(orgtyp_done$type_of_org == "C"),]



C <- C[,-c(1:3,15:16)] #remove non numeric columns
tC <- t(C)   #transform
C <- t(tC)   #was coming up as non numeric so tranformed again to overwrite

matC <- tC %*%  C



#set row and column names 
rownames(matC) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matC)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")



##try re ordering matrix here

matC2 <- matC[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]



########### put into network analysis code 


matC2[lower.tri(matC)] <- NA
diag(matC2) <- NA

Clista2 <- matC2 %>% melt() 
Clista2 <- Clista2[-which(is.na(Clista2$value)),]

Cnet2 <- graph_from_data_frame(d=Clista2, directed=T) 

E(Cnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(0,3,1,8,0,0,1,5,6,8,3), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 



E(Cnet2)$width <- E(Cnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(Cnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 


jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_Corporation.jpg")
plot(Cnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 
#Save the file 
dev.off()

```


Military 
no. species = 4
no. partners = 11
```{r include=FALSE}
M <- orgtyp_done[which(orgtyp_done$type_of_org == "M"),]



M <- M[,-c(1:3,15:16)] #remove non numeric columns
tM <- t(M)   #transform
M <- t(tM)   #was coming up as non numeric so tranformed again to overwrite

matM <- tM %*%  M



#set row and column names 
rownames(matM) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matM)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")



##try re ordering matrix here

matM2 <- matM[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]



########### put into network analysis code 


matM2[lower.tri(matM)] <- NA
diag(matM2) <- NA

Mlista2 <- matM2 %>% melt() 
Mlista2 <- Mlista2[-which(is.na(Mlista2$value)),]

Mnet2 <- graph_from_data_frame(d=Mlista2, directed=T) 

E(Mnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(5,3,1,9,1,5,6,9,6,7,0), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 



E(Mnet2)$width <- E(Mnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(Mnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 


#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_Military.jpg")
plot(Mnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 
#Save the file 
dev.off()

```



P = Private landowner
no. species = 9
no. partners = 12
```{r include=FALSE}
P <- orgtyp_done[which(orgtyp_done$type_of_org == "P"),]

P <- P[,-c(1:3,15:16)] #remove non numeric columns
tP <- t(P)   #transform
P <- t(tP)   #was coming up as non numeric so tranformed again to overwrite

matP <- tP %*%  P



#set row and column names 
rownames(matP) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matP)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")



##try re ordering matrix here

matP2 <- matP[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]



########### put into network analysis code 


matP2[lower.tri(matP)] <- NA
diag(matP2) <- NA

Plista2 <- matP2 %>% melt() 
Plista2 <- Plista2[-which(is.na(Plista2$value)),]

Pnet2 <- graph_from_data_frame(d=Plista2, directed=T) 

E(Pnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(0,6,0,10,0,0,1,3,5,6,4), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 



E(Pnet2)$width <- E(Pnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(Pnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 


#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_PrivateLandowner.jpg")
plot(Pnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 
#Save the file 
dev.off()

```



SW = State Wildlife (Agency) 
no. species = 20
no. partners = 28
```{r include=FALSE}
### Have cut off issues with this one 

SW <- orgtyp_done[which(orgtyp_done$type_of_org == "SW"),]

SW <- SW[,-c(1:3,15:16)] #remove non numeric columns
tSW <- t(SW)   #transform
SW <- t(tSW)   #was coming up as non numeric so tranformed again to overwrite

matSW <- tSW %*%  SW



#set row and column names 
rownames(matSW) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matSW)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")



##try re ordering matrix here

matSW2 <- matSW[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]



########### put into network analysis code 


matSW2[lower.tri(matSW)] <- NA
diag(matSW2) <- NA

SWlista2 <- matSW2 %>% melt() 
SWlista2 <- SWlista2[-which(is.na(SWlista2$value)),]

SWnet2 <- graph_from_data_frame(d=SWlista2, directed=T) 

E(SWnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(8,6,5,19,1,10,15,17,17,17,6), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 



E(SWnet2)$width <- E(SWnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(SWnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 


#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_StateWildlifeAgency.jpg")
plot(SWnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 
#Save the file 
dev.off()

```




BLM
no. species = 14
no. partners = 18
```{r include=FALSE}
### Have cut off issues with this one 

BLM <- orgtyp_done[which(orgtyp_done$type_of_org == "BLM"),]

BLM <- BLM[,-c(1:3,15:16)] #remove non numeric columns
tBLM <- t(BLM)   #transform
BLM <- t(tBLM)   #was coming up as non numeric so tranformed again to overwrite

matBLM <- tBLM %*%  BLM



#set row and column names 
rownames(matBLM) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matBLM)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

##try re ordering matrix here

matBLM2 <- matBLM[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]


########### put into network analysis code 


matBLM2[lower.tri(matBLM)] <- NA
diag(matBLM2) <- NA

BLMlista2 <- matBLM2 %>% melt() 
BLMlista2 <- BLMlista2[-which(is.na(BLMlista2$value)),]

BLMnet2 <- graph_from_data_frame(d=BLMlista2, directed=T) 

E(BLMnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(4,4,0,15,0,8,6,10,12,10,4), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(BLMnet2)$width <- E(BLMnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(BLMnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 


#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_BLM.jpg")
plot(BLMnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 
#Save the file 
dev.off()

```



USFWS
no. species = 34
no. partners = 43
```{r include=FALSE}
### Have cut off issues with this one 

USFWS <- orgtyp_done[which(orgtyp_done$type_of_org == "USFWS"),]

USFWS <- USFWS[,-c(1:3,15:16)] #remove non numeric columns
tUSFWS <- t(USFWS)   #transform
USFWS <- t(tUSFWS)   #was coming up as non numeric so tranformed again to overwrite

matUSFWS <- tUSFWS %*%  USFWS



#set row and column names 
rownames(matUSFWS) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matUSFWS)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

##try re ordering matrix here

matUSFWS2 <- matUSFWS[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]


########### put into network analysis code 


matUSFWS2[lower.tri(matUSFWS)] <- NA
diag(matUSFWS2) <- NA

USFWSlista2 <- matUSFWS2 %>% melt() 
USFWSlista2 <- USFWSlista2[-which(is.na(USFWSlista2$value)),]

USFWSnet2 <- graph_from_data_frame(d=USFWSlista2, directed=T) 

E(USFWSnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(4,6,4,13,1,15,18,16,15,25,15), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(USFWSnet2)$width <- E(USFWSnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(USFWSnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up

#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_USFWS.jpg")
plot(USFWSnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up
#Save the file 
dev.off()

```
note on this one I ended up changing vertex.label.dist but still haviing trouble with cut offs 



FO = Federal Other
no. species = 11
no. partners = 14
```{r include=FALSE}
FO <- orgtyp_done[which(orgtyp_done$type_of_org == "FO"),]

FO <- FO[,-c(1:3,15:16)] #remove non numeric columns
tFO <- t(FO)   #transform
FO <- t(tFO)   #was coming up as non numeric so tranformed again to overwrite

matFO <- tFO %*%  FO


#set row and column names 
rownames(matFO) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matFO)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

##try re ordering matrix here

matFO2 <- matFO[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]


########### put into network analysis code 


matFO2[lower.tri(matFO)] <- NA
diag(matFO2) <- NA

FOlista2 <- matFO2 %>% melt() 
FOlista2 <- FOlista2[-which(is.na(FOlista2$value)),]

FOnet2 <- graph_from_data_frame(d=FOlista2, directed=T) 

E(FOnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(3,2,1,8,1,6,4,8,9,8,1), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(FOnet2)$width <- E(FOnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(FOnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 

#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_FederalOther.jpg")
plot(FOnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 
#Save the file 
dev.off()

```


N = NGO
no. species = 7
no. partners = 9
```{r include=FALSE}
N <- orgtyp_done[which(orgtyp_done$type_of_org == "N"),]

N <- N[,-c(1:3,15:16)] #remove non numeric columns
tN <- t(N)   #transform
N <- t(tN)   #was coming up as non numeric so tranformed again to overwrite

matN <- tN %*%  N



#set row and column names 
rownames(matN) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matN)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

##try re ordering matrix here

matN2 <- matN[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]


########### put into network analysis code 


matN2[lower.tri(matN)] <- NA
diag(matN2) <- NA

Nlista2 <- matN2 %>% melt() 
Nlista2 <- Nlista2[-which(is.na(Nlista2$value)),]

Nnet2 <- graph_from_data_frame(d=Nlista2, directed=T) 

E(Nnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(0,0,4,7,1,2,2,3,8,6,2), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(Nnet2)$width <- E(Nnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(Nnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 


#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_NGO.jpg")
plot(Nnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4, vertex.label.degree=lab.locs) ## note the node sizes were scaled up
#Save the file 
dev.off()

```




R = Reserach 
no. species = 4
no. partners = 4
```{r include=FALSE}
R <- orgtyp_done[which(orgtyp_done$type_of_org == "R"),]

R <- R[,-c(1:3,15:16)] #remove non numeric columns
tR <- t(R)   #transform
R <- t(tR)   #was coming up as non numeric so tranformed again to overwrite

matR <- tR %*%  R

#set row and column names 
rownames(matR) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matR)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

##try re ordering matrix here

matR2 <- matR[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]


########### put into network analysis code 


matR2[lower.tri(matR)] <- NA
diag(matR2) <- NA

Rlista2 <- matR2 %>% melt() 
Rlista2 <- Rlista2[-which(is.na(Rlista2$value)),]

Rnet2 <- graph_from_data_frame(d=Rlista2, directed=T) 

E(Rnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(0,2,1,0,0,0,0,1,1,2,1), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(Rnet2)$width <- E(Rnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(Rnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 



#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_Reserach.jpg")
plot(Rnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up
#Save the file 
dev.off()
```




SG = State Governmnet
no. species = 5
no. partners = 6
```{r include=FALSE}
SG <- orgtyp_done[which(orgtyp_done$type_of_org == "SG"),]

SG <- SG[,-c(1:3,15:16)] #remove non numeric columns
tSG <- t(SG)   #transform
SG <- t(tSG)   #was coming up as non numeric so tranformed again to overwrite

matSG <- tSG %*%  SG

#set row and column names 
rownames(matSG) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matSG)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

##try re ordering matrix here

matSG2 <- matSG[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]


########### put into network analysis code 


matSG2[lower.tri(matSG)] <- NA
diag(matSG2) <- NA

SGlista2 <- matSG2 %>% melt() 
SGlista2 <- SGlista2[-which(is.na(SGlista2$value)),]

SGnet2 <- graph_from_data_frame(d=SGlista2, directed=T) 

E(SGnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(0,1,0,3,0,1,0,0,3,3,3), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(SGnet2)$width <- E(SGnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(SGnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 


#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_StateGovernmnet.jpg")
plot(SGnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 
#Save the file 
dev.off()

```



USFS
no. species = 12
no. partners = 12
```{r include=FALSE}
USFS <- orgtyp_done[which(orgtyp_done$type_of_org == "USFS"),]

USFS <- USFS[,-c(1:3,15:16)] #remove non numeric columns
tUSFS <- t(USFS)   #transform
USFS <- t(tUSFS)   #was coming up as non numeric so tranformed again to overwrite

matUSFS <- tUSFS %*%  USFS

#set row and column names 
rownames(matUSFS) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matUSFS)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

##try re ordering matrix here

matUSFS2 <- matUSFS[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]


########### put into network analysis code 


matUSFS2[lower.tri(matUSFS)] <- NA
diag(matUSFS2) <- NA

USFSlista2 <- matUSFS2 %>% melt() 
USFSlista2 <- USFSlista2[-which(is.na(USFSlista2$value)),]

USFSnet2 <- graph_from_data_frame(d=USFSlista2, directed=T) 

E(USFSnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(0,5,3,11,1,2,4,9,6,4,3), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(USFSnet2)$width <- E(USFSnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(USFSnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 



#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_USFS.jpg")
plot(USFSnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up
#Save the file 
dev.off()

```





SL
no. species = 11 
no. partners = 16
```{r include=FALSE}
### Have cut off issues with this one 

SL <- orgtyp_done[which(orgtyp_done$type_of_org == "SL"),]

SL <- SL[,-c(1:3,15:16)] #remove non numeric columns
tSL <- t(SL)   #transform
SL <- t(tSL)   #was coming up as non numeric so tranformed again to overwrite

matSL <- tSL %*%  SL

#set row and column names 
rownames(matSL) <- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

colnames(matSL)<- c("Land Water Management","Species Management", "Awareness", "Law","Econ","Conservation Planning", "Policy", "Research", "Education","Instiutional Development", "Funding")

##try re ordering matrix here

matSL2 <- matSL[c(4,2,3,1,5,9,7,8,6,10,11),c(4,2,3,1,5,9,7,8,6,10,11)]


########### put into network analysis code 


matSL2[lower.tri(matSL)] <- NA
diag(matSL2) <- NA

SLlista2 <- matSL2 %>% melt() 
SLlista2 <- SLlista2[-which(is.na(SLlista2$value)),]

SLnet2 <- graph_from_data_frame(d=SLlista2, directed=T) 

E(SLnet2)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")


node.size<-setNames(c(6,2,0,13,0,8,8,8,11,10,5), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(SLnet2)$width <- E(SLnet2)$value 

radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}

n <- 11

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(SLnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 


#write to jpeg
jpeg(file = "output/FiguresForPaper_8_31/ActionsDoneByPlayerType_StateLandManagement.jpg")
plot(SLnet2, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size*2,  vertex.label.dist=4.65, vertex.label.degree=lab.locs) ## note the node sizes were scaled up 
#Save the file 
dev.off()

```



<br>


<br>


<br>


<br>



###For each type of org. make bar graph of action frequency
(below is the frequency - in Data_exploration_S have the same graphs but as a proportion)


C = Corporation
no. species = 5
no. partners = 11
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

C <- orgtyp_done[which(orgtyp_done$type_of_org == "C"),]

C <- done[which(done$type_of_org == "C"),]

prop <- C 
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: Coroporation") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```



M = Military 
no. species = 4
no. partners = 11
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

M <- orgtyp_done[which(orgtyp_done$type_of_org == "M"),]

M <- done[which(done$type_of_org == "M"),]

prop <- M
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: Military") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```


P = Private landowner
no. species = 9
no. partners = 12
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

P <- orgtyp_done[which(orgtyp_done$type_of_org == "P"),]

P <- done[which(done$type_of_org == "P"),]

prop <- P
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: Private Landowner") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```

SW = State Wildlife (Agency)
no. species = 20
no. partners = 28
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

SW <- orgtyp_done[which(orgtyp_done$type_of_org == "SW"),]

SW <- done[which(done$type_of_org == "SW"),]

prop <- SW
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: State Wildlife (Agency)") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```


BLM
no. species = 14
no. partners = 18
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

BLM <- orgtyp_done[which(orgtyp_done$type_of_org == "BLM"),]

BLM <- done[which(done$type_of_org == "BLM"),]

prop <- BLM
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: BLM") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```



USFWS
no. species = 31
no. partners = 34
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

USFWS <- orgtyp_done[which(orgtyp_done$type_of_org == "USFWS"),]

USFWS <- done[which(done$type_of_org == "USFWS"),]

prop <- USFWS
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: USFWS") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```


FO = Federal Other
no. species = 11
no. partners = 14
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

FO <- orgtyp_done[which(orgtyp_done$type_of_org == "FO"),]

FO <- done[which(done$type_of_org == "FO"),]

prop <- FO
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: Federal Other") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```


N = NGO
no. species = 6
no. partners = 9
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

N <- orgtyp_done[which(orgtyp_done$type_of_org == "N"),]

N <- done[which(done$type_of_org == "N"),]

prop <- N
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: NGO") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```


R = Reserach 
no. species = 4
no. partners = 4
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

R <- orgtyp_done[which(orgtyp_done$type_of_org == "R"),]

R <- done[which(done$type_of_org == "R"),]

prop <- R
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: Reserach") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```


SG = State Governmnet
no. species = 5
no. partners = 6
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

SG <- orgtyp_done[which(orgtyp_done$type_of_org == "SG"),]

SG <- done[which(done$type_of_org == "SG"),]

prop <- SG
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: State Governmnet") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```


USFS
no. species = 12
no. partners = 12
```{r}
done <- orgtyp_done[,-c(1:3,15)]

USFS <- orgtyp_done[which(orgtyp_done$type_of_org == "USFS"),]

USFS <- done[which(done$type_of_org == "USFS"),]

prop <- USFS
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: USFS") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```


SL
no. species = 11
no. partners = 16
```{r echo=FALSE}
done <- orgtyp_done[,-c(1:3,15)]

SL <- orgtyp_done[which(orgtyp_done$type_of_org == "SL"),]

SL <- done[which(done$type_of_org == "SL"),]

prop <- SL
prop <- colSums(prop[,-c(12)])
prop <- as.data.frame(prop)
prop <- prop  %>% rownames_to_column()

ggplot(prop, aes(x = rowname, y = prop)) + 
    geom_bar(stat = "identity")  + theme(axis.text.x = element_text(angle = 30)) + ggtitle("Frequency of each action for org type: State Land") + scale_x_discrete(name ="Action") + scale_y_continuous(name ="Frequency")
```




<br>


<br>


<br>


## Add network statistics for 
Note, for networks already created above, some code has been repeated to have all code needed to create network and code for network statistic in the same location within this script 

- entire dataset 
    - Salafsky
    - all partners
- type categories 


A make network for entire dataset 
This is network for entrie dataframe where:
nodes = actions
edges = partners
```{r check_zero,  eval = FALSE, include=FALSE}
allnet <- orgtyp_done

#remove replicated rows (was only done for where needed to double list org types )

allnet <- allnet[,-c(16)]

##trial remove duplicates
#dupes <- get_dupes(allnet) #which rows are duplicated
#nodupes <- distinct(dupes) #now have 1/2 number = worked

## checking in this dataset 
allnet <- distinct(allnet)

#now remove all numeric columns 
allnet <- allnet[,c(4:14)]

zeros1 <- remove_empty(allnet, which = "rows") # not finding any all zeros? 
#make 0 == NULL then re run 

zeros[which(zeros$X1..Land.Water.Management == 0),1] <- NA # 11 is the column called 'land water management'
zeros[which(zeros$X2..Species.Management== 0),2] <- NA
zeros[which(zeros$X3..Awareness.raising== 0),3] <- NA
zeros[which(zeros$X4..law.enforcement.and.prosecution== 0),4] <- NA
zeros[which(zeros$X5..livelihood..economic.and.moral.incentrives== 0),5] <- NA
zeros[which(zeros$X6..Conservation.Design.and.Planning== 0),6] <- NA
zeros[which(zeros$X7..Legal.and.Policy.frameworks == 0),7] <- NA
zeros[which(zeros$X8..Research.and.monitoring== 0),8] <- NA
zeros[which(zeros$X9..Education.and.Training== 0),9] <- NA
zeros[which(zeros$X10..Institutional.Development== 0),10] <- NA
zeros[which(zeros$funding == 0),11] <- NA

## now start actual calcs 
allnet <- orgtyp_done

#remove replicated rows (was only done for where needed to double list org types )
allnet <- allnet[,-c(16)]
allnet <- distinct(allnet)

#now remove all numeric columns 
allnet <- allnet[,c(4:14)]
tan <- t(allnet)
allnet <- t(tan)

mat_allnet <- tan %*%  allnet
```
Note - stopped because this wasn't the node/edge set up that we wanted... correct on below 


####This is network for entrie dataframe where:
Salafsky dataset.. 
nodes = partners
edges = species

1. recombine so that each row is a species and all partners are in string
```{r}
allnet <- orgtyp_done
#remove replicated rows (was only done for where needed to double list org types )
allnet <- allnet[,-c(16)]
allnet <- distinct(allnet)

allnet <- allnet[,c(1,3,15)]


### get rid of repeating partner names for same species so that don't get list in result 

allnet2 <- allnet %>% group_by(Scientific.name, Common.name) %>% distinct(partner.in.agreement)

## Didn't need dumb loop!!!
change2 <-  allnet2 %>% pivot_wider(names_from = partner.in.agreement, values_from = Scientific.name)

#this was was got originally so can check 
#change <-  allnet %>% pivot_wider(names_from = partner.in.agreement, values_from = varname)
## based on differences in dim [15] should be that many repetitions.. 

## Didn't need dumb loop!!!


names <- change2[,c(1,2)]
#change all values to 1s and 0s
change2[!is.na(change2)] <- 1
change2 <- change2[,-c(1)]
#change3 <- cbind(names,change2)  ##not sure why but this isn't working so can't reconnect sci names with values
change2[is.na(change2)] <- 0


## make matrix

# first need to unlist
mydf <- change2
df <- cbind(mydf[!sapply(mydf, is.list)], 
      (t(apply(mydf[sapply(mydf, is.list)], 1, unlist))))
#now go from character to numeric

for(i in 1:131){
  df[,i] <- as.numeric(df[,i])  # silly hack because it wouldn't let me change columns to numeric in one go??
}

tdf <- t(df)
df <- t(tdf) #another hack to make numeric

#matrix!
salfTmat <- tdf %*% df

salfTmat[lower.tri(salfTmat)] <- NA
diag(salfTmat) <- NA

salfTmatlist <- salfTmat %>% melt() 
salfTmatlist <- salfTmatlist[-which(is.na(salfTmatlist$value)),]

salfTnet <- graph_from_data_frame(d=salfTmatlist, directed=T) 

E(salfTnet)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")

### commenting this out because unless needed it's going to be a real pain to feed in mannually 
#node.size<-setNames(c(6,2,0,13,0,8,8,8,11,10,5), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(salfTnet)$width <- E(salfTnet)$value 


plot(salfTnet, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, vertex.size=node.size) 
#removed - layout=layout_in_circle,

plot(salfTnet, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, vertex.size=node.size) 



##trying to make sure this is working --> layout=layout_in_circle seems to remove edge display 
jpeg(file = "output/entiredatasettest.jpg")
plot(salfTnet, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size) 
#Save the file 
dev.off()


```



Do network stats for total partners in salafsky subset here!! ****
```{r}

```


####This is network for entrie dataframe where:
Larger (non salafsky subset) dataset.. 
nodes = partners
edges = species

EditedData made way earlier in script 
```{r}
tED <- t(EditedData[,-c(1:3)])
ED <- t(tED) #another hack to make numeric

#matrix!
EDmat <- tED %*% ED

EDmat[lower.tri(EDmat)] <- NA
diag(EDmat) <- NA

EDmatlist <- EDmat %>% melt() 
EDmatlist <- EDmatlist[-which(is.na(EDmatlist$value)),]

EDnet <- graph_from_data_frame(d=EDmatlist, directed=T) 

E(EDnet)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")

### commenting this out because unless needed it's going to be a real pain to feed in mannually 
#node.size<-setNames(c(6,2,0,13,0,8,8,8,11,10,5), c("Law","Species Management", "Awareness","Land Water Management","Econ","Education", "Policy", "Research", "Conservation Planning","Instiutional Development", "Funding"))
 

E(EDnet)$width <- E(EDnet)$value 

plot(EDnet, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size)
```

not sure if there are any lines at all here... 

filter > 1 to make sure working correctly
```{r Eval = FALSE}
EDmatlist <- EDmat %>% melt() 
EDmatlist <- EDmatlist[which(EDmatlist$value > 1),]

EDnet <- graph_from_data_frame(d=EDmatlist, directed=T) 

E(EDnet)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)

E(EDnet)$width <- E(EDnet)$value 

plot(EDnet, vertex.color="white", edge.color= "black", vertex.label.color="black", rescale=F, layout=layout_in_circle, vertex.size=node.size)
```


Do network stats for total partners in salafsky subset here!! ****
```{r}

```



####This org type network from salafsky dataset:
(note, could be done with larger dataset...)
nodes = org type
edges = species

orgtype_adjmat made earlier in script 
```{r echo=FALSE, include=FALSE}
tadjmat <- orgtype_adjmat


#set row and column names 
rownames(tadjmat) <- c("BLM", "Federal Other", "USFS", "USFWS", "Private Landowner", "State Land", "State Government", "Reserach","Military","Corporation", "State Wildlife", "NGO")

colnames(tadjmat)<- c("BLM", "Federal Other", "USFS", "USFWS", "Private Landowner", "State Land", "State Government", "Reserach","Military","Corporation", "State Wildlife", "NGO")

tadjmat[lower.tri(tadjmat)] <- NA
diag(tadjmat) <- NA

tolist <- tadjmat %>% melt() 
tolist <- tolist[-which(is.na(tolist$value)),]


#library(igraph)

net <- graph_from_data_frame(d=tolist, directed=T) 


E(net)$arrow.size <- .02 #determine size of arrows (this makes the heads real small so they are more like lines)
#V(net)$names <- c("a","b","c","d","e","f","g","h") #naming the nodes -- try this later so don't over write what actal names are 
#V(df)$names <- c("hab_x_x", "over_x_x", "poll_x_x", "spsp_x_x", "env_x_x", "demo_x_x")

node.size<-setNames(c(14,11,12,34,11,10,6,5,5,5,19,6), c("BLM","FO","USFS","USFWS","P","SL","SG","R","M","C","SW","N"))
  #so not setting in the same order 
#V(net)$label <- NA
E(net)$width <- E(net)$value

plot(net, vertex.size=node.size)

l <- layout_in_circle(net)

plot(net, rescale=F, vertex.color="white", edge.color= "black", vertex.label.color="black", vertex.size=node.size, layout = l)


## source of code - https://stackoverflow.com/questions/23209802/placing-vertex-label-outside-a-circular-layout-in-igraph
radian.rescale <- function(x, start=0, direction=1) {
  c.rotate <- function(x) (x + start) %% (2 * pi) * direction
  c.rotate(scales::rescale(x, c(0, 2 * pi), range(x)))
}


n <- 12
#g <- erdos.renyi.game(n, 0.5)
## Obviously labeling in this way this only makes sense for graphs
## laid out as a circle to begin with

lab.locs <- radian.rescale(x=1:n, direction=-1, start=0)

plot(net, rescale=F, vertex.color="white", edge.color= "black", vertex.label.color="black", vertex.size=node.size, layout = l, vertex.label.dist=4,
     vertex.label.degree=lab.locs, vertex.label.cex	= .5)


## will rescale node size so doesn't cut off
#plot(net, rescale=F, vertex.color="white", edge.color= "black", vertex.label.color="black", vertex.size=node.size*.5, layout = l, vertex.label.dist=4,
#     vertex.label.degree=lab.locs, vertex.label.cex	= .5)
## Even now still is a bit cut off and can't see size differences :/ 
```
Commented out layout modifications so doesn't look as nice but still same network 

Network stats for org types 
Average degree: Every node has # of edges conected so accross all nodes in network, on average what is the # of edges connected to each node 
```{r}
#mean(degree(net), mode = "total") this didn't work 

##taken from creating matrix in earlier script
tadjmat <- orgtype_adjmat
#set row and column names 
rownames(tadjmat) <- c("BLM", "Federal Other", "USFS", "USFWS", "Private Landowner", "State Land", "State Government", "Reserach","Military","Corporation", "State Wildlife", "NGO")
colnames(tadjmat)<- c("BLM", "Federal Other", "USFS", "USFWS", "Private Landowner", "State Land", "State Government", "Reserach","Military","Corporation", "State Wildlife", "NGO")
diag(tadjmat) <- NA


#change to 1s and 0s so can get degree
simplified_mat <- tadjmat %>% replace((. > 0),1)

added <- rowSums(simplified_mat, na.rm = TRUE) #this gives the correct number of edges across each node

#now find the average
sum(added)/11 #12 is number of nodes in network but nodes can't be connected to themselves so makes sense to use 11??

mean(added) #comment above is why values are differenet 

```
** I don't think degree(net) is correct bc there is no connection between military and coporation but it says 11 anyway 

Average weighted degree
```{r}
added <- rowSums(tadjmat, na.rm = TRUE) #this gives the correct number of edges across each node

#now find the average
sum(added)/11 #12 is number of nodes in network but nodes can't be connected to themselves so makes sense to use 11??

mean(added) #comment above is why values are differenet 



## Old attempt // scrapwork 
#strength(net, vids = V(net),
#  loops = FALSE, weights = wts)
#(net)$weight <- wts
#mean(degree(net))
#tadjmat <- orgtype_adjmat
#wts <- colSums(tadjmat)
#sumwts <- sum(wts)
#sumwts
```
Modularity
```{r}
modularity(net)
```
note: make membership vectors that are type categories - run newman girvan function furst 
run on entire dataset 
future ref - https://rpubs.com/shestakoff/sna_lab5


centrality: Eigenvector
```{r}
eigen_centrality(net, directed=F, weights=NA)

centr_eigen(net, directed=T, normalized=T)
```


centrality: Betweenness
```{r}
betweenness(net, directed=F, weights=NA)

edge_betweenness(net, directed=F, weights=NA)

centr_betw(net, directed=T, normalized=T) ## this gives out put but changes when change directed (I don't think our network is directed)
```


<br>

<br>

Initial thoughts 

Network statistics:
-	Average degree = ave number of orgs/type of orgs that work together
      Average degree is simply the average number of edges per node in the graph. It is relatively straightforward to calculate:: Total Edges/Total Nodes =Average Degree

-	Average weighted degree – weights of links between nodes = average number of ?? on by partners averages 
-	Modularity – groups of parnters that cluster together
Seems straightforward - https://igraph.org/r/doc/modularity.igraph.html
For nodes themselves (either partners or partner types)
-	Can calculate centrality 
Notes on options provided in tutorial
