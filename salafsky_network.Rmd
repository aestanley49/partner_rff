---
title: "salafsky_network"
author: "Annabelle"
date: "February 24, 2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


```{r, include = FALSE, echo = FALSE}
## setup the file structure so that this markdown document is in the main project folder along with the other folders noted below

DataSource <- "./data" # input raw dataset goes here
output.dir <-"./output" # output dataset writes to here
functions.dir <- "./functions" # directory for functions 

source(file.path(functions.dir,'cleaning_salafsky.R')) # any functions that are called up by this markdown document need to be sourced here

## general functions that need to be read in. I like to put them at the top so they are easier to deal with when they change version (inevitable)

library(tidyverse)
library(skimr)
```

# Methods

For XXX species that have been precluded from listing due to conservation actions:

We collected data from Federal Register documents, recovery plans, and YYY (need description of data sources) on 
  -	How many partners were involved in the recovery 
  - Who the partners were, (subset)
  - What the partners were doing (subset of subset) 
ï‚§     -	Categorized to Salafsky action headings + a few categories (?)

```{r, echo = FALSE, include = FALSE}
##this chunk is used to format the data set. 
## can use it to make settings etc.

CleanData <- read.csv(paste0(DataSource,"/codesalafsky.csv"), stringsAsFactors = FALSE) #removing end piece doesn't change it to factor (just back to character)
##change to tibble if needed
?as_tibble
newdata <- CleanData %>%  as_tibble() ##this is a tibble 

## ideally, the raw dataset gets noted here, then you do any data manipulations in code and generate a useable dataset for later manipulations. I didn't have the dataset you called up in your code, so I put this one in to demonstrate. I would like it if we coudl get from this dataset in code "copyoflatestsummerwork_Partnerships_Precluded_species_recovered.xlsx"

code <- cleaning_salafsky(newdata)
##function includes 1s and 0s? 


#function not running
#code <- CleanData2
code <- CleanData

head(as.numeric(CleanData2[,c(10:11)]))

code2 <- read.csv(paste0(DataSource,"/tableofpartnersandactions.csv"), stringsAsFactors = FALSE, header = TRUE)

class(code$funding)
summary(code2) #now should be numeric 
```

Summary Stats
- # species
- # docs/agreements? 

```{r}
unique(code$Common.name) ##41
unique(code$Scientific.name) ##41
    ##41 of original 90 species represented here 

#count by two columns? 
#unique(df[c("yad", "per")])
??count.unique
require(vctrs)
vec_count(code[c("agreement.number", "Common.name")])
  ##51 different agreements 
```

# partners 
  - need to address: 
    - strings sperated by ","
    - spelling and Capitolization errors 
    - new notation like 'all parties' or 'private landowners' 
```{r}
##subset based on type of partner so don't have any multi (Should exclude any multi partner strings)
##then count unique 

nom <- code[-which(code$type.of.partners == "M"),]
View(nom)
unique(nom$partner.in.agreement)
  #139 

#had 139 before but now only 95?

```


```{r}
skim(code, partner.in.agreement)
```


row and col sums 
```{r}
class(as.numeric(code$funding))
class(code$funding)
class(code2$funding)
num <- as.numeric(code[-c(1:9)])

as.numeric(unlist(code$X1..Land.Water.Management))
as.numeric(unlist(code$X2..Species.Management))

rowSums(as.numeric(code2[,c(10:11)]))

colSums(code[,-c(1:9)])

is.numeric(code$X10..Institutional.Development)


is.tibble(code2)

df <- as_tibble(code)
df <- df %>% convert(num(funding))
dat[, c(3,6:15,37)] <- sapply(dat[, c(3,6:15,37)], as.numeric)

### this works
code2[,c(11:21)] <- sapply(code2[ ,c(11:21)], as.numeric)
class(code2$X6..Conservation.Design.and.Planning)

rowSums((code2[,c(11:21)]))

colSums(code2[,c(11:21)])


```


histograms
```{r}
plot(code$X1..Land.Water.Management)

rsum <- (rowSums(code2[,c(11:21)]))

ggplot(data = code2, mapping = aes(x=rsum)) + geom_bar()

csum <- (colSums(code2[,c(11:21)]))

plot(csum)
#ggplot(code2) + geom_point(aes(x=csum, y=csum)) weird error message 

```

